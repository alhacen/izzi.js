"use strict";var allNodes=[];const objToRendererMap=new Map,varToAttributesMap=new Map,varToObjectMap=new Map,AttributesToObjectMap=new Map,setStateTostateMap=new Map,stateToObjectMap=new Map,magicTagToscriptMap=new Map,stateToMagicTagMap=new Map,varToMagicTagMap=new Map,stateToAttributeMap=new Map,escapeHTML=e=>{let t=document.createElement("div");return t.innerText=e,t.innerHTML};function escapeHTMLWrapper(t){for(var e=/\${(.*?)\}/g,a=[],r=e.exec(t);null!=r;)a.push(r[1]),r=e.exec(t);return a.map(e=>{t=t.replaceAll(`\${${e}}`,"${escapeHTML("+e+")}")}),t}const inputToEvetntMap=new Map,loop=e=>{for(var t,a=e.childNodes,r=0;r<a.length;r++)a[r]&&"IZZI"!==a[r].nodeName&&("INPUT"!==a[r].nodeName||(t=a[r].getAttribute("iChange"))&&(inputToEvetntMap.get(a[r])||inputToEvetntMap.set(a[r],[]),inputToEvetntMap.get(a[r]).push(t)),0<a[r].childNodes.length&&loop(a[r]),allNodes.push(a[r]))};function parseVar(e){for(var t=/\{\{(.*?)\}\}/g,a=[],r=t.exec(e);null!=r;)a.push(r[1]),r=t.exec(e);return a}const initAttributes=()=>{let e,n;allNodes.map(r=>{if(r.attributes)for(let a=0;a<r.attributes.length;a++)n=r.attributes[a].value,e=parseVar(r.attributes[a].value),e.length&&e.map(e=>{var t=new Function(`return ${e.substr(0,e.indexOf("."))}`)();n=n.replaceAll(`{{${e}}}`,"${"+e+"}"),stateToAttributeMap.get(t?.id)?.includes(r)||varToAttributesMap.get(e)?.includes(r)||("state"===t?.type?(stateToAttributeMap.get(t.id)||stateToAttributeMap.set(t.id,[]),stateToAttributeMap.get(t.id).push({object:r,attribute:r.attributes[a].name,renderer:new Function("return ()=>{return `"+n+"`}")()})):(varToAttributesMap.get(e)||varToAttributesMap.set(e,[]),varToAttributesMap.get(e).push({object:r,attribute:r.attributes[a].name,renderer:new Function("return ()=>{return `"+n+"`}")()})))})})},initInnerText=()=>{let e,r;allNodes.map(a=>{a.data&&(r=a.data,r=r.replace(/\s+/g," "),e=parseVar(r),e.length&&(e.map(e=>{var t=new Function(`return ${e.substr(0,e.indexOf("."))}`)();stateToObjectMap.get(t?.id)?.includes(a)||varToObjectMap.get(e)?.includes(a)||("state"===t?.type?(stateToObjectMap.get(t.id)||stateToObjectMap.set(t.id,[]),stateToObjectMap.get(t.id).push(a)):(varToObjectMap.get(e)||varToObjectMap.set(e,[]),varToObjectMap.get(e).push(a))),r=r.replaceAll(`{{${e}}}`,"${"+e+"}")}),window.y=r,objToRendererMap.set(a,new Function("return { render :()=>{return `"+r+"`}}")())))})},render=()=>{[...objToRendererMap.keys()].map(e=>{e.data=objToRendererMap.get(e).render()}),[...stateToAttributeMap.values()].map(e=>{e.map(e=>{"value"===e.attribute?e.object.value=e.renderer():e.object.setAttribute(e.attribute,e.renderer())})}),[...varToAttributesMap.values()].map(e=>{e.map(e=>{"value"===e.attribute?e.object.value=e.renderer():e.object.setAttribute(e.attribute,e.renderer())})})},reRender=e=>{stateToObjectMap.get(e)?.map(e=>{e.data=objToRendererMap.get(e).render()}),stateToAttributeMap.get(e)?.map(e=>{console.log(e),"value"===e.attribute?e.object.value=e.renderer():e.object.setAttribute(e.attribute,e.renderer())}),stateToMagicTagMap.get(e)?.map(e=>{let t;t=magicTagToscriptMap.get(e),console.log(escapeHTMLWrapper(`return ${t.replaceAll("&gt;",">").replaceAll("&lt;","<").trim()}`)),t=new Function(escapeHTMLWrapper(`return ${t.replaceAll("&gt;",">").replaceAll("&lt;","<").trim()}`))(),console.log(t),t?Array.isArray(t)?e.innerHTML=t.join(""):"object"==typeof t?e.innerHTML=JSON.stringify(t):e.innerHTML=escapeHTMLWrapper(t):e.innerHTML=""})},useState=e=>{let t={type:"state",id:setStateTostateMap.size,state:e,set:e=>{t.state=e,reRender(t.id)},get:()=>t.state};return setStateTostateMap.set(setStateTostateMap.size,t),t},initMagicTag=()=>{let r=document.getElementsByTagName("IZZI"),e,n,t;for(let a=0;a<r.length;a++)n=r[a].innerHTML,e=parseVar(n),e.length&&e.map(e=>{var t=new Function(`return ${e.substr(0,e.indexOf("."))}`)();stateToMagicTagMap.get(t?.id)?.includes(r[a])||varToMagicTagMap.get(e)?.includes(r[a])||("state"===t?.type?(stateToMagicTagMap.get(t.id)||stateToMagicTagMap.set(t.id,[]),stateToMagicTagMap.get(t.id).push(r[a])):(varToMagicTagMap.get(e)||varToMagicTagMap.set(e,[]),varToMagicTagMap.get(e).push(r[a]))),n=n.replaceAll(`{{${e}}}`,e)}),n=n.replaceAll("&gt;",">").replaceAll("&lt;","<").trim(),magicTagToscriptMap.set(r[a],n),t=new Function(`return ${n}`)(),console.log(`return ${n.replaceAll("&gt;",">").replaceAll("&lt;","<").trim()}`),t?Array.isArray(t)?r[a].innerHTML=t.join(""):"object"==typeof t?r[a].innerHTML=JSON.stringify(t):r[a].innerHTML=t:r[a].innerHTML=""},init=async e=>{loop(document.getElementById(e)),initAttributes(),initInnerText(),initMagicTag(),render()};