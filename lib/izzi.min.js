"use strict";var allNodes=[];const objToRendererMap=new Map,varToAttributesMap=new Map,varToObjectMap=new Map,AttributesToObjectMap=new Map,setStateTostateMap=new Map,stateToObjectMap=new Map,magicTagToscriptMap=new Map,stateToMagicTagMap=new Map,varToMagicTagMap=new Map;stateToAttributeMap=new Map;const escapeHTML=e=>{let t=document.createElement("div");return t.innerText=e,t.innerHTML};function escapeHTMLWrapper(e){for(var t=/\${(.*?)\}/g,a=[],r=t.exec(e);null!=r;)a.push(r[1]),r=t.exec(e);return a.map(t=>{e=e.replaceAll(`\${${t}}`,"${escapeHTML("+t+")}")}),e}const inputToEvetntMap=new Map,loop=e=>{for(var t=e.childNodes,a=0;a<t.length;a++)if(t[a]&&"IZZI"!==t[a].nodeName){if("INPUT"===t[a].nodeName){let e=t[a].getAttribute("iChange");e&&(inputToEvetntMap.get(t[a])||inputToEvetntMap.set(t[a],[]),inputToEvetntMap.get(t[a]).push(e))}t[a].childNodes.length>0&&loop(t[a]),allNodes.push(t[a])}};function parseVar(e){for(var t=/\{\{(.*?)\}\}/g,a=[],r=t.exec(e);null!=r;)a.push(r[1]),r=t.exec(e);return a}const initAttributes=()=>{let e,t;allNodes.map(a=>{if(a.attributes)for(let r=0;r<a.attributes.length;r++)t=a.attributes[r].value,(e=parseVar(a.attributes[r].value.split(" "))).length&&e.map(e=>{var n,i;let p=new Function(`return ${e.substr(0,e.indexOf("."))}`)();t=t.replaceAll(`{{${e}}}`,"${"+e+"}"),null!==(n=stateToAttributeMap.get(null==p?void 0:p.id))&&void 0!==n&&n.includes(a)||null!==(i=varToAttributesMap.get(e))&&void 0!==i&&i.includes(a)||("state"===(null==p?void 0:p.type)?(stateToAttributeMap.get(p.id)||stateToAttributeMap.set(p.id,[]),stateToAttributeMap.get(p.id).push({object:a,attribute:a.attributes[r].name,renderer:new Function("return ()=>{return `"+t+"`}")()})):(varToAttributesMap.get(e)||varToAttributesMap.set(e,[]),varToAttributesMap.get(e).push({object:a,attribute:a.attributes[r].name,renderer:new Function("return ()=>{return `"+t+"`}")()})))})})},initInnerText=()=>{let e,t;allNodes.map(a=>{a.data&&(t=(t=a.data).replace(/\s+/g," "),(e=parseVar(t)).length&&(e.map(e=>{var r,n;let i=new Function(`return ${e.substr(0,e.indexOf("."))}`)();null!==(r=stateToObjectMap.get(null==i?void 0:i.id))&&void 0!==r&&r.includes(a)||null!==(n=varToObjectMap.get(e))&&void 0!==n&&n.includes(a)||("state"===(null==i?void 0:i.type)?(stateToObjectMap.get(i.id)||stateToObjectMap.set(i.id,[]),stateToObjectMap.get(i.id).push(a)):(varToObjectMap.get(e)||varToObjectMap.set(e,[]),varToObjectMap.get(e).push(a)),t=t.replaceAll(`{{${e}}}`,"${"+e+"}"))}),window.y=t,objToRendererMap.set(a,new Function("return { render :()=>{return `"+t+"`}}")())))})},render=()=>{[...objToRendererMap.keys()].map(e=>{e.data=objToRendererMap.get(e).render()}),[...stateToAttributeMap.values()].map(e=>{e.map(e=>{e.object.setAttribute(e.attribute,e.renderer())})}),[...varToAttributesMap.values()].map(e=>{e.map(e=>{e.object.setAttribute(e.attribute,e.renderer())})})},reRender=e=>{var t,a,r;null===(t=stateToObjectMap.get(e))||void 0===t||t.map(e=>{e.data=objToRendererMap.get(e).render()}),null===(a=stateToAttributeMap.get(e))||void 0===a||a.map(e=>{console.log(e),e.object.setAttribute(e.attribute,e.renderer())}),null===(r=stateToMagicTagMap.get(e))||void 0===r||r.map(e=>{console.log(e),izziReturn=magicTagToscriptMap.get(e),console.log(escapeHTMLWrapper(`return ${izziReturn.replaceAll("&gt;",">").replaceAll("&lt;","<").trim()}`)),izziReturn=new Function(escapeHTMLWrapper(`return ${izziReturn.replaceAll("&gt;",">").replaceAll("&lt;","<").trim()}`))(),console.log(izziReturn),izziReturn?Array.isArray(izziReturn)?e.innerHTML=izziReturn.join(""):"object"==typeof izziReturn?e.innerHTML=JSON.stringify(izziReturn):e.innerHTML=escapeHTMLWrapper(izziReturn):e.innerHTML=""})},useState=e=>{let t={type:"state",id:setStateTostateMap.size,state:e,set:e=>{t.state=e,reRender(t.id)},get:()=>t.state};return setStateTostateMap.set(setStateTostateMap.size,t),t},initMagicTag=()=>{let e,t,a,r=document.getElementsByTagName("IZZI");for(let n=0;n<r.length;n++)(e=parseVar(t=r[n].innerHTML)).length&&e.map(e=>{var a,i;let p=new Function(`return ${e.substr(0,e.indexOf("."))}`)();null!==(a=stateToMagicTagMap.get(null==p?void 0:p.id))&&void 0!==a&&a.includes(r[n])||null!==(i=varToMagicTagMap.get(e))&&void 0!==i&&i.includes(r[n])||("state"===(null==p?void 0:p.type)?(stateToMagicTagMap.get(p.id)||stateToMagicTagMap.set(p.id,[]),stateToMagicTagMap.get(p.id).push(r[n])):(varToMagicTagMap.get(e)||varToMagicTagMap.set(e,[]),varToMagicTagMap.get(e).push(r[n]))),t=t.replaceAll(`{{${e}}}`,e)}),magicTagToscriptMap.set(r[n],t),(a=new Function(`return ${t.replaceAll("&gt;",">").replaceAll("&lt;","<").trim()}`)())?Array.isArray(a)?r[n].innerHTML=a.join(""):r[n].innerHTML="object"==typeof a?JSON.stringify(a):a:r[n].innerHTML=""},init=async e=>{loop(document.getElementById(e)),initAttributes(),initInnerText(),initMagicTag(),[...objToRendererMap.keys()].map(e=>{e.data=objToRendererMap.get(e).render()}),[...stateToAttributeMap.values()].map(e=>{e.map(e=>{e.object.setAttribute(e.attribute,e.renderer())})}),[...varToAttributesMap.values()].map(e=>{e.map(e=>{e.object.setAttribute(e.attribute,e.renderer())})})};